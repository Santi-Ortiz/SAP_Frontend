<div class="rentar-container" *ngIf="propiedadSeleccionada">

  <!-- Informaci√≥n de la propiedad seleccionada -->
  <div class="propiedad-seleccionada">
    <h1>Solicitud de Renta</h1>
    
    <div class="propiedad-resumen">
      <div class="propiedad-imagen">
        <img [src]="propiedadSeleccionada.fotoPrincipal" 
             [alt]="propiedadSeleccionada.direccion"
             >
        <span class="tipo-badge" [class]="propiedadSeleccionada.tipo">
          {{propiedadSeleccionada.tipo}}
        </span>
      </div>
      
      <div class="propiedad-datos">
        <h2>{{propiedadSeleccionada.direccion}}</h2>
        <p class="ubicacion">üìç {{propiedadSeleccionada.ubicacion}}</p>
        <div class="caracteristicas-rapidas">
          <span>üõèÔ∏è {{propiedadSeleccionada.numeroCuartos}} cuartos</span>
          <span class="precio">{{formatearPrecio(propiedadSeleccionada.renta)}}/mes</span>
        </div>
        <p class="propietario">üë§ Propietario: {{propiedadSeleccionada.nombreDueno}}</p>
      </div>
    </div>
  </div>

  <!-- Formulario de datos del cliente -->
  <div class="formulario-section" *ngIf="mostrarFormulario && !procesando">
    <h2>üìã Datos del Solicitante</h2>
    <p class="instrucciones">
      Complete la siguiente informaci√≥n para procesar su solicitud de alquiler.
      Todos los campos son obligatorios.
    </p>

    <form class="formulario-cliente" (ngSubmit)="enviarSolicitud()">
      
      <!-- Nombre completo -->
      <div class="campo-grupo">
        <label for="nombre">Nombre Completo *</label>
        <input 
          type="text" 
          id="nombre" 
          [(ngModel)]="cliente.nombre" 
          name="nombre"
          placeholder="Ingrese su nombre completo"
          (blur)="onBlurNombre()"
          [class.campo-error]="camposTocados.nombre && errores.nombre"
          required>
        <span class="mensaje-error" *ngIf="camposTocados.nombre && errores.nombre">{{errores.nombre}}</span>
      </div>

      <!-- Contrase√±a -->
      <div class="campo-grupo">
        <label for="contrasena">Contrase√±a *</label>
        <input 
          type="password" 
          id="contrasena" 
          [(ngModel)]="cliente.contrasena" 
          name="contrasena"
          placeholder="M√≠nimo 6 caracteres"
          (blur)="onBlurContrasena()"
          [class.campo-error]="camposTocados.contrasena && errores.contrasena"
          required>
        <span class="mensaje-error" *ngIf="camposTocados.contrasena && errores.contrasena">{{errores.contrasena}}</span>
      </div>

      <!-- Correo electr√≥nico -->
      <div class="campo-grupo">
        <label for="correo">Correo Electr√≥nico *</label>
        <input 
          type="email" 
          id="correo" 
          [(ngModel)]="cliente.correoElectronico" 
          name="correo"
          placeholder="ejemplo@correo.com"
          (blur)="onBlurCorreo()"
          [class.campo-error]="camposTocados.correoElectronico && errores.correoElectronico"
          required>
        <span class="mensaje-error" *ngIf="camposTocados.correoElectronico && errores.correoElectronico">{{errores.correoElectronico}}</span>
        <small class="ayuda-texto">Formato v√°lido: usuario@dominio.com</small>
      </div>

      <!-- Tipo de identificaci√≥n -->
      <div class="campo-grupo">
        <label for="tipoId">Tipo de Identificaci√≥n *</label>
        <select 
          id="tipoId" 
          [(ngModel)]="cliente.tipoIdentificacion" 
          name="tipoId"
          (blur)="onBlurTipoId()"
          [class.campo-error]="camposTocados.tipoIdentificacion && errores.tipoIdentificacion"
          required>
          <option value="">Seleccione un tipo</option>
          <option value="CC">C√©dula de Ciudadan√≠a</option>
          <option value="CE">C√©dula de Extranjer√≠a</option>
          <option value="PA">Pasaporte</option>
          <option value="TI">Tarjeta de Identidad</option>
          <option value="NIT">NIT</option>
        </select>
        <span class="mensaje-error" *ngIf="camposTocados.tipoIdentificacion && errores.tipoIdentificacion">{{errores.tipoIdentificacion}}</span>
      </div>

      <!-- N√∫mero de identificaci√≥n -->
      <div class="campo-grupo">
        <label for="numeroId">N√∫mero de Identificaci√≥n *</label>
        <input 
          type="text" 
          id="numeroId" 
          [(ngModel)]="cliente.numeroIdentificacion" 
          name="numeroId"
          placeholder="Ingrese su n√∫mero de identificaci√≥n"
          (blur)="onBlurNumeroId()"
          [class.campo-error]="camposTocados.numeroIdentificacion && errores.numeroIdentificacion"
          required>
        <span class="mensaje-error" *ngIf="camposTocados.numeroIdentificacion && errores.numeroIdentificacion">{{errores.numeroIdentificacion}}</span>
      </div>

      <!-- Botones de acci√≥n -->
      <div class="botones-accion">
        <button type="button" class="btn-cancelar" (click)="volverABuscar()">
          ‚Üê Volver a Buscar
        </button>
        <button type="submit" class="btn-enviar" [disabled]="!validarFormularioSinErrores()">
          Enviar Solicitud
        </button>
      </div>

    </form>
  </div>

  <!-- Pantalla de procesamiento -->
  <div class="procesando-section" *ngIf="procesando">
    <div class="loader-container">
      <div class="loader"></div>
      <h2>‚è≥ Procesando su solicitud...</h2>
      <p>Por favor espere mientras procesamos su informaci√≥n.</p>
    </div>
  </div>

  <!-- Mensaje de confirmaci√≥n -->
  <div class="confirmacion-section" *ngIf="solicitudEnviada && !procesando">
    <div class="mensaje-exito">
      <div class="icono-exito">‚úÖ</div>
      <h2>¬°Solicitud Enviada Exitosamente!</h2>
      <p class="mensaje-principal">
        Su solicitud de alquiler para la propiedad <strong>{{propiedadSeleccionada.direccion}}</strong> 
        ha sido recibida y est√° siendo procesada.
      </p>
      
      <div class="info-procesamiento">
        <h3>Proceso de Validaci√≥n</h3>
        <p>
          Su solicitud est√° siendo <strong>procesada y validada por la instituci√≥n financiera</strong>. 
          Este proceso puede tomar entre 24 a 72 horas h√°biles.
        </p>
        
        <div class="pasos-siguientes">
          <h4>üìã Pr√≥ximos pasos:</h4>
          <ul>
            <li>Recibir√° un correo de confirmaci√≥n en: <strong>{{cliente.correoElectronico}}</strong></li>
            <li>La instituci√≥n financiera validar√° su informaci√≥n</li>
            <li>Se comunicar√°n con usted para coordinar la firma del contrato</li>
            <li>El propietario ser√° notificado de su inter√©s</li>
          </ul>
        </div>

        <div class="datos-referencia">
          <h4>üìÑ Datos de referencia:</h4>
          <p><strong>Solicitante:</strong> {{cliente.nombre}}</p>
          <p><strong>Identificaci√≥n:</strong> {{cliente.tipoIdentificacion}} {{cliente.numeroIdentificacion}}</p>
          <p><strong>Fecha de solicitud:</strong> {{fechaSolicitud}}</p>
          <p><strong>N√∫mero de referencia:</strong> #{{numeroReferencia}}</p>
        </div>
      </div>

      <div class="botones-finales">
        <button class="btn-nueva-busqueda" (click)="volverABuscar()">
          Buscar Otras Propiedades
        </button>
      </div>
    </div>
  </div>

</div>

<!-- Mensaje de error si no se encuentra la propiedad -->
<div class="error-container" *ngIf="!propiedadSeleccionada">
  <h2>Propiedad no encontrada</h2>
  <p>Lo sentimos, no pudimos encontrar la propiedad solicitada.</p>
  <button class="btn-volver" (click)="volverABuscar()">
    ‚Üê Volver a Buscar Propiedades
  </button>
</div>